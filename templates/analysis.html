<!DOCTYPE html>
<html>
    <head>
        <title>VulnSense</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" type="text/css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500&display=swap" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='analysis-style.css') }}">
      </head>
<body>
    <nav class="navbar navbar-expand-md navbar-white bg-white" style="padding: 10px; border-bottom: 1px solid lightgray; box-shadow: 0 0 10px rgba(0, 0, 0, 0.2); position: sticky;">
        <div class="container"> <a class="navbar-brand" href="#">
            <img class="logo" src="{{ url_for('static', filename='images/VulnSenseLogo.jpg') }}" style="width: 40px; height: 30px; margin-bottom: 6px; margin-right: 3px;" alt="Logo">
            <b>VULNSENSE</b>
          </a> <button class="navbar-toggler navbar-toggler-right border-0" type="button" data-toggle="collapse" data-target="#navbar10">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbar10">
            <ul class="navbar-nav ml-auto">
              <li class="nav-item"> <a class="nav-link" href="#">Home</a> </li>
              <li class="nav-item"> <a class="nav-link" href="#">About</a> </li>
            </ul> <a class="btn navbar-btn ml-md-2 btn-light text-dark">Contact Us</a>
          </div>
        </div>
      </nav>
    <div class="container">
        <div class="circle-container">
            <div class="circle-wrap">
                <div class="circle">
                <div class="mask full">
                    <div class="fill"></div>
                </div>
                <div class="mask half">
                    <div class="fill"></div>
                </div>
                <div class="inside-circle"> {{progress_value}} </div>
                </div>
            </div>
            <div class="scan-info" style="color:{{color}}">{{text}}</div>
        </div>
        <script>
          progress_score = {{progress_value}}
          if (progress_score > 100) 
              progress_score = 100;
          const rotation = Math.round((progress_score / 100) * 180); // Rounded rotation value
          console.log(rotation);
          
          const circleFill = document.querySelector(".circle .fill");
          circleFill.style.transform = `rotate(${rotation}deg)`; // Updated from rotate to rotateZ
          
          const fillAnimation = circleFill.animate(
            [{ transform: "rotateZ(0deg)" }, { transform: `rotate(${rotation}deg)` }],
            {
              duration: 3000,
              easing: "ease-in-out"
            }
          );
          
          fillAnimation.addEventListener("finish", () => {
            circleFill.style.transform = `rotateZ(${rotation}deg)`;
          });
        </script>
        <div class="info-box">
            <div class="box-heading" style="color: {{color}}">{{flag_count}} security vendor(s) flagged this contract as vulnerable.</div>
            <div class="box-content">
                <p class="box-desc">There are {{unique_non_one_values}} distinct types of identified vulnerabilities in the contract.</p>
                <table class="table table-bordered" id="box-table">
                    <thead>
                      <tr>
                        <th scope="col">Severity</th>
                        <th scope="col">Count</th>
                      </tr>
                    </thead>
                    <tbody> 
                      <tr style="background-color: darkred; color: white;">
                        <td>Critical</td>
                        <td>{{severity_counts['critical']}}</td>
                      </tr>
                      <tr style="background-color: red; color: white;">
                        <td>High</td>
                        <td>{{severity_counts['high']}}</td>
                      </tr>
                      <tr style="background-color: orange; color: white;">
                        <td>Medium</td>
                        <td>{{severity_counts['medium']}}</td>
                      </tr>
                    </tbody>
                  </table>
            </div>
        </div>
    </div>
    <div class="stats-container">
        <div class="custom-accordion">
            <div class="card">
                <div class="card-header" id="headingTwo">
                  <h5 class="mb-0 scan-title">
                    <button class="btn btn-link collapsed scan-toggle" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                      VIEW SOURCE CODE
                    </button>
                  </h5>
                </div>
                <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordion">
                  <div class="card-body">
                    Content
                  </div>
                </div>
            </div>
            <div class="card">
                <div class="card-header" id="headingOne">
                <h5 class="mb-0 scan-title">
                    <button class="btn btn-link scan-toggle" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                    SCAN STATISTICS
                    </button>
                </h5>
                </div>
        
                <div id="collapseOne" class="collapse show" aria-labelledby="headingOne">
                    <div class="card-body">
                        <div class="custom-div">
                        <div class="left-text">Security Score</div>
                        <div class="right-text">{{progress_value}}/100.00</div>
                        </div>
                        <div class="custom-div">
                        <div class="left-text">Detection Time</div>
                        <div class="right-text">{{elapsed_time}} seconds</div>
                        </div>
                        <div class="custom-div">
                        <div class="left-text">Total lines inspected</div>
                        <div class="right-text">{{codelines}}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
            <nav class="page__menu page__custom-settings menu">
                <ul class="menu__list r-list">
                  <li class="menu__group">
                    <a href="#" class="menu__link r-link text-underlined" id="detection-link">Detection</a>
                  </li>
                  <li class="menu__group">
                    <a href="#" class="menu__link r-link text-underlined" id="details-link">Details</a>
                  </li>
                </ul>
              </nav>
              
              <div id="detection" class="content" style="display:none;">
                <table class="table" id="result-table">
                    <thead class="thead-dark">
                      <tr>
                        <th scope="col">#</th>
                        <th scope="col">Model Name</th>
                        <th scope="col">Result</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <th scope="row">1</th>
                        <td>VulnSense</td>
                        <td>{{prediction_text_format[results[0][3]]}}</td>
                      </tr>
                      <tr>
                        <th scope="row">2</th>
                        <td>BiLSTM-BERT</td>
                        <td>{{prediction_text_format[results[0][0]]}}</td>
                      </tr>
                      <tr>
                        <th scope="row">3</th>
                        <td>BiLSTM-GNN</td>
                        <td>{{prediction_text_format[results[0][1]]}}</td>
                      </tr>
                      <tr>
                        <th scope="row">4</th>
                        <td>BERT-GNN</td>
                        <td>{{prediction_text_format[results[0][2]]}}</td>
                      </tr>
                    </tbody>
                  </table>
                  <canvas id="dec_time_chart" style="max-width: 500px"></canvas>
              </div>
              
              <div id="details" class="content" style="display:none;">
                <h3>Details Content</h3>
                <p>This is the content for the Details option.</p>
              </div>
              
              <script>
                const detectionLink = document.getElementById('detection-link');
                const detailsLink = document.getElementById('details-link');
                const detectionContent = document.getElementById('detection');
                const detailsContent = document.getElementById('details');
              
                detectionLink.addEventListener('click', () => {
                  detectionContent.style.display = 'flex';
                  detailsContent.style.display = 'none';
                });
              
                detailsLink.addEventListener('click', () => {
                  detectionContent.style.display = 'none';
                  detailsContent.style.display = 'flex';
                });

                // Chart.js configuration
                const chartData = {{results[1]}}.map((value) => parseFloat(value.toFixed(2)));

                print(chartData)

                const ctx = document.getElementById('dec_time_chart').getContext('2d');
                new Chart(ctx, {
                  type: 'bar',
                  data: {
                    labels: ['VulnSense', 'BiLSTM-BERT', 'BiLSTM-GNN', 'BERT-GNN'],
                    datasets: [
                      {
                        label: 'Prediction Time (secs)',
                        data: chartData,
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1,
                      },
                    ],
                  },
                  options: {
                    responsive: true,
                    scales: {
                      y: {
                        beginAtZero: true,
                      },
                    },
                  },
                });
              </script>
    </div>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
</body> 
</html>
